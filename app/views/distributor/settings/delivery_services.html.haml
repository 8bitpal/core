- title 'Delivery Service Settings', false
- show_settings_sub_nav

#delivery_services
  .delivery_services
    .row-fluid
      .span6
        Your organisation will use one or more Delivery Services to deliver to customers.
        Each of your customers will be assigned to a Delivery Service that best services their location.
      .span6
        %span.heading hint
        It's best to name your Delivery Service according to the geographic region it services.
        For example: Inner City, Northern Suburbs, Regional Courier, National Courier, Packing Center Pickup.

    %table.table.table-condensed.spacer#delivery_services
      %tr
        %td{colspan: 3}
          - first_delivery_service = delivery_services.one?
          = link_to 'javascript:void(0)', class: (first_delivery_service ? 'required-action' : 'action'), 'data-toggle' => 'collapse', 'data-target' => '#new_delivery_service' do
            Create
            = first_delivery_service ? 'your first' : 'a new'
            <strong>delivery service</strong>

      - delivery_services.each do |delivery_service|
        - if delivery_service.persisted?
          %tr{ 'data-toggle' => 'collapse', 'data-target' => "#edit_delivery_service_#{delivery_service.id}" }
            %td.name
              %strong= link_to delivery_service.name, 'javascript:void(0)'
            %td.days
              = delivery_service.delivery_days
            %td.fee
              %span= delivery_service.formatted_fee

        %tr.edit
          %td{colspan: 3}
            = simple_form_for(delivery_service, url: distributor_settings_delivery_services_path, html: { novalidate: false, class: 'collapse background-yellow' }) do |f|
              = f.hidden_field :id if delivery_service.id
              = f.hidden_field :delete, value: 0

              .container-fluid
                .line
                  = f.input_field :name, class: 'name', required: true, placeholder: 'Name'

                  %span#weekdays.days.text-center
                    = f.simple_fields_for(:schedule_rule) do |schedule_rule_form|
                      - %i(mon tue wed thu fri sat sun).each do |day|
                        = schedule_rule_form.input_field day, inline_label: true, label: "<br><span class='label label-default'>#{day}</span>".html_safe

                  = f.input_field :fee, class: 'fee pull-right', required: true, placeholder: '0.00', title: 'Fee'
                .line
                  = f.input_field :instructions, class: 'instructions pull-left', required: true, placeholder: "i.e. instructions to customers including area of service for deliveries, estimated delivery or pickup times", rows: 8
                  = f.input_field :pickup_point, inline_label: true, label: "<i class='icon-shopping-cart'></i> This is a pickup point".html_safe

                .line.clearfix

                .form-actions.pull-right
                  = link_to 'cancel', 'javascript:void(0)', 'data-toggle' => 'collapse', 'data-target' => (delivery_service.new_record? ? "#new_delivery_service" : "#edit_delivery_service_#{delivery_service.id}")

                  &nbsp;
                  - if delivery_service.customers.empty?
                    = link_to_function "delete", "$(this).closest('form').find('input[id=delivery_service_delete]').val(1).closest('form').submit()"
                  - else
                    = link_to 'delete', 'javascript:void(0)', onclick: "alert('You must reassign #{pluralize(delivery_service.customers.count, "customer")} before deleting this delivery service.');"

                  = f.button :submit, 'Save', class: 'btn btn-primary'

