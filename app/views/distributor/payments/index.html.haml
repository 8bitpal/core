%h2 Customer Payments

#upload_more_transactions.reveal-modal
  = simple_form_for(@import_transaction_list, url: match_payments_distributor_payments_path, html: {:multipart => true} ) do |f|
    %fieldset
      %legend Import data from your bank
      %p Please select the bank statement provided by your bank (.csv file)
      = f.error_notification
      - if @import_transaction_list.csv_parser.present? && !@import_transaction_list.csv_parser.rows.reject(&:valid?).size.zero?
        %span.error= @import_transaction_list.csv_parser.rows.find(&:invalid?).errors.full_messages.join(', ')
      = f.input :file_format, as: :select, collection: ImportTransactionList::FILE_FORMATS, label: "CSV File Format", include_blank: false
      = f.input :csv_file, label: false

      .actions
        = f.button :submit, "Upload"

.row
  .twelve.columns
    %table.payments
      %thead
        %tr
          %th Date
          %th{width: '400px'} Description
          %th Amount
          %th Account
          %th{width: '240px'} Customer
          %th
      %tbody
        %tr.row_action.import_more_transactions
          %td{colspan: 6}= link_to((@import_transactions.blank? ? "Import transactions" : "Import more transactions"), "", {'data-reveal-id'=> 'upload_more_transactions', id: 'upload_more_transactions_link'})
        - if @import_transactions.blank?
          - @import_transaction_lists.each do |import_transaction_list|
            %tr
              %td{colspan: 6}
                = render partial: 'draft_transactions', locals: {import_transaction_list: import_transaction_list}
        = render partial: 'distributor/import_transactions/rows'
        %tr.row_action
          %td{colspan: 6}= link_to_function "load more", "window.payments.load_more_rows_on_bottom()" unless @import_transactions.blank?

- if @import_transaction_list.csv_parser.present? && !@import_transaction_list.csv_parser.rows.reject(&:valid?).size.zero?
  :javascript
    $(function() {
      $("#upload_more_transactions_link").click();
    })
